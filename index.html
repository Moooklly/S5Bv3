<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>S5B</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Tahoma, Arial; background: #121212; color: #f1f1f1; padding: 20px; }
    header { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 20px; }
    h1 { margin: 0; color: #fff; }
    .admin-btn, .back-btn, #retryBtn { cursor: pointer; border-radius: 6px; border: none; padding: 10px 15px; }
    .admin-btn { background:#ff9800; color:#000; }
    .admin-btn:hover{background:#e68900;}
    .back-btn{background:#f44336;color:#fff;margin-top:20px;}
    .back-btn:hover{background:#c62828;}
    #retryBtn{background:#ff9800;color:#000;margin-top:20px;}
    #retryBtn:hover{background:#e68900;}
    .question{background:#1e1e1e;padding:15px;margin-bottom:15px;border-radius:8px;border:1px solid #333;}
    h2{margin:0 0 10px;font-size:18px;}
    textarea{width:100%;height:80px;border-radius:6px;border:1px solid #555;background:#2a2a2a;color:#fff;padding:8px;}
    .submit-container{text-align:center;margin-top:20px;}
    button.submit-btn{background:#4caf50;color:#fff;padding:12px 20px;font-size:16px;border:none;border-radius:8px;}
    button.submit-btn:hover{background:#388e3c;}
    #answersBox, #waitingMessage{display:none;background:#1e1e1e;padding:20px;border-radius:8px;border:1px solid #333;margin-top:30px;text-align:center;}
    .submission{margin-bottom:30px;padding:10px;border:1px solid #444;border-radius:6px;background:#2a2a2a;}
    .answer-item{margin-bottom:15px;}
    .answer-item strong{color:#ff9800;}
  </style>
</head>
<body>
  <header>
    <h1>اختبار المرشحين لـ الأداره في سيرفر صخب</h1>
    <button class="admin-btn" onclick="askPassword()">عليا</button>
  </header>

  <div id="questionsContainer">
    <div class="question"><h2>سؤال 1: ما هو اسمك؟</h2><textarea placeholder="اكتب إجابتك هنا"></textarea></div>
    <div class="question"><h2>سؤال 2: كم عمرك؟</h2><textarea placeholder="اكتب إجابتك هنا"></textarea></div>
    <div class="question"><h2>سؤال 3: أين تسكن؟</h2><textarea placeholder="اكتب إجابتك هنا"></textarea></div>
    <div class="submit-container">
      <button class="submit-btn" onclick="collectAnswers()">إرسال الإجابات</button>
    </div>
  </div>

  <div id="waitingMessage">
    <p>✅ تم إرسال إجابتك بنجاح، الرجاء انتظار الرد من المسؤولين.</p>
    <button id="retryBtn" onclick="retryExam()">🔄 الاختبار من جديد</button>
  </div>

  <div id="answersBox">
    <h2>جميع إجابات المرشحين</h2>
    <div id="answersList"></div>
    <button class="back-btn" onclick="goBack()">عودة</button>
  </div>

  <script>
    // إعدادات Firebase - استبدلها بمعلومات مشروعك
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function collectAnswers() {
      const questions = document.querySelectorAll(".question h2");
      const answers = document.querySelectorAll(".question textarea");
      let submission = [];

      questions.forEach((q, i) => {
        submission.push({ question: q.innerText, answer: answers[i].value || "لم تتم الإجابة" });
      });

      const newKey = db.ref('submissions').push().key;
      db.ref('submissions/' + newKey).set(submission);

      document.getElementById("questionsContainer").style.display = "none";
      document.getElementById("waitingMessage").style.display = "block";
    }

    function askPassword() {
      const password = prompt("أدخل كلمة المرور:");
      if (password === "00124") {
        showAnswers();
      } else if (password !== null) {
        alert("❌ كلمة المرور غير صحيحة");
      }
    }

    function retryExam() {
      const password = prompt("أدخل كلمة المرور لإعادة الاختبار:");
      if (password === "00124") {
        resetExam();
      } else if (password !== null) {
        alert("❌ كلمة المرور غير صحيحة");
      }
    }

    function resetExam() {
      document.querySelectorAll(".question textarea").forEach(t => t.value = "");
      document.getElementById("waitingMessage").style.display = "none";
      document.getElementById("answersBox").style.display = "none";
      document.getElementById("questionsContainer").style.display = "block";
    }

    function showAnswers() {
      const answersList = document.getElementById("answersList");
      answersList.innerHTML = "";

      db.ref('submissions').once('value', snapshot => {
        const data = snapshot.val();
        if (!data) {
          answersList.innerHTML = "<p>لا توجد إجابات بعد.</p>";
          return;
        }
        Object.keys(data).forEach((key, index) => {
          const submission = data[key];
          const div = document.createElement("div");
          div.className = "submission";
          div.innerHTML = `<h3>📌 المرشح رقم ${index + 1}</h3>`;
          submission.forEach(item => {
            div.innerHTML += `<div class="answer-item"><strong>${item.question}</strong><br>${item.answer}</div>`;
          });
          answersList.appendChild(div);
        });
      });

      document.getElementById("waitingMessage").style.display = "none";
      document.getElementById("questionsContainer").style.display = "none";
      document.getElementById("answersBox").style.display = "block";
    }

    function goBack() {
      document.getElementById("answersBox").style.display = "none";
      document.getElementById("waitingMessage").style.display = "none";
      document.getElementById("questionsContainer").style.display = "block";
    }
  </script>
</body>
</html>
